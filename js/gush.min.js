/*

Gush - Aggregating torrent search engine
Copyright (C) 2013 tombazza

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.

*/
var $Gush=function(){function m(){d||$(this).removeClass("passcode").val("").attr("type","password")}function n(){d||$(this).val("").attr("type","text").val("passcode?").addClass("passcode")}function p(a){if(13==a.which)if(d){h=!1;$("body").removeClass("error");b&&b.fnClearTable();e=[];a=$("#query").val();$("#query").addClass("loading");for(i=0;3>i;i++)g++,j.push($.post("data.php",{e:i,q:a,p:d},k,"json"))}else d=$(this).val(),$(this).addClass("loading"),$.post("data.php",{a:1,p:d},k,"json")}function k(a){if(!h)if(a.error){a=
a.error;var d=$("#query");console.log(a);$("body").removeClass("load").addClass("error");d.attr("type","text").val("Error: "+a.message);2==(!0).code?(d.attr("disabled","disabled").blur(),$.each(j,function(a,c){c.abort()}),setTimeout(function(){window.location=window.location},3E3)):d.removeClass("loading")}else if(a.auth)$("body").removeClass("load"),$("#query").removeClass("loading").attr("type","text").val(""),yepnope({load:{dtCss:"//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/css/jquery.dataTables.css",
dtJs:"//cdnjs.cloudflare.com/ajax/libs/datatables/1.9.4/jquery.dataTables.min.js"},callback:{dtJs:function(){jQuery.extend(jQuery.fn.dataTableExt.oSort,{"file-size-pre":function(a){var c=a.substring(0,a.length-2);a="MB"==a.substring(a.length-2,a.length)?1E3:"GB"==a.substring(a.length-2,a.length)?1E6:1;return parseInt(c*a,10)},"file-size-asc":function(a,c){return a<c?-1:a>c?1:0},"file-size-desc":function(a,c){return a<c?1:a>c?-1:0}})}}});else{g--;var f={bPaginate:!1,bFilter:!1,bInfo:!1,aaData:[],aoColumns:[{sTitle:"Name",
sWidth:"70%"},{sTitle:"Size",sType:"file-size"},{sTitle:"Seeds"},{sTitle:"Peers"}]};$.each(a,function(a,c){var b=c.hash.toUpperCase();"undefined"===typeof e[b]?(e[b]=c,e[b].metadata=[c.metadata],f.aaData.push([c.name,c.size,c.seeds,c.peers,b])):(e[b].magnetParts.tr=e[b].magnetParts.tr.concat(c.magnetParts.tr),e[b].metadata.push(c.metadata))});0==g&&$("#query").removeClass("loading");b?b.fnAddData(f.aaData):b=$("#results").dataTable(f);b.fnSort([[2,"desc"]]);$("#results tbody tr").unbind("click");
$("#results tbody tr").bind("click",function(){if(b.fnIsOpen(this))b.fnClose(this);else{var a=b.fnGetData(this)[4];b.fnClose(l);b.fnOpen(this,q(a),"info_row");l=this}})}}function q(a){a=e[a];console.log(a);a="magnet:?xt="+a.magnetParts.xt[0]+"&tr="+a.magnetParts.tr.join("&tr=")+"&dn="+a.magnetParts.dn[0];f.find("a.magnet").attr("href",a);return f}var b=!1,l=!1,f=!1,e=[],g=0,d=!1,h=!1,j=[];return{init:function(){$("#query").keydown(p);$("#query").focus(m);$("#query").blur(n);f=$(".info_content").clone()}}}();
$(document).ready($Gush.init);
